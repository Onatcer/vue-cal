import{l as ve,c as k,b as m,d as u,K as _,q as P,g as d,F as N,j as q,i as G,e as H,f as oe,w as z,A as te,L as De,y as W,H as ge,M as V,N as R,T as ye,t as F,r as ee,x as fe,o as pe,O as ke,m as Te,D as Oe,I as he,n as Q,h as Ee,z as re,P as Me,Q as Ne,R as Ae,S as Ve,U as Re}from"./index-bcGq9Fyj.js";import{w as _e,m as ne,p as ce,d as Fe,e as Pe,u as Ie}from"./index-VlXfylGg.js";const He=24*60,We={allDayEvents:{type:[Boolean,String],default:!1},clickToNavigate:{type:Boolean,default:void 0},dark:{type:Boolean,default:!1},datePicker:{type:Boolean,default:!1},disableDays:{type:Array,default:()=>[]},editableEvents:{type:[Boolean,Object],default:!1},eventCreateMinDrag:{type:Number,default:15},events:{type:Array,default:()=>[]},eventCount:{type:Boolean,default:!1},eventsOnMonthView:{type:Boolean,default:!1},hideWeekdays:{type:Array,default:()=>[]},hideWeekends:{type:Boolean,default:!1},locale:{type:String,default:""},maxDate:{type:[String,Date],default:""},minDate:{type:[String,Date],default:""},selectedDate:{type:[String,Date],default:""},sm:{type:Boolean,default:!1},specialHours:{type:Object,default:()=>({})},schedules:{type:Array,default:()=>[]},snapToInterval:{type:Number,default:0},startWeekOnSunday:{type:Boolean,default:!1},theme:{type:[String,Boolean],default:"default"},time:{type:Boolean,default:!0},timeAtCursor:{type:Boolean,default:!1},timeCellHeight:{type:Number,default:40},timeFormat:{type:String,default:""},timeFrom:{type:Number,default:0},timeStep:{type:Number,default:60},timeTo:{type:Number,default:He},titleBar:{type:Boolean,default:!0},todayButton:{type:Boolean,default:!0},twelveHour:{type:Boolean,default:!1},view:{type:String,default:""},viewDate:{type:[String,Date],default:""},viewDayOffset:{type:Number,default:0},views:{type:[Array,Object]},viewsBar:{type:Boolean,default:!0},watchRealTime:{type:Boolean,default:!1},weekNumbers:{type:Boolean,default:!1},xs:{type:Boolean,default:!1}},je={class:"vuecal__header"},Ue={key:0,class:"vuecal__views-bar"},qe=["onClick","innerHTML"],Ge={key:1,class:"vuecal__title-bar"},Ke={class:"vuecal__transition-wrap"},Qe=["disabled","innerHTML"],Je={__name:"header",setup(J){const D=ve("vuecal"),{view:n,config:l}=D,o=()=>{l.clickToNavigate&&n.broader()},h=k(()=>l.clickToNavigate?{click:o}:{});return(Y,f)=>(u(),m("div",je,[_(Y.$slots,"header",{view:d(n),availableViews:d(l).availableViews,vuecal:d(D)}),Y.$slots.header?P("",!0):(u(),m(N,{key:0},[d(l).viewsBar?(u(),m("div",Ue,[(u(!0),m(N,null,q(d(l).availableViews,($,t)=>(u(),m("button",{class:G(["vuecal__view-button",{"vuecal__view-button--active":d(n).id===t}]),onClick:s=>d(n).switch(t),innerHTML:d(D).texts[t],type:"button"},null,10,qe))),256))])):P("",!0),d(l).titleBar?(u(),m("nav",Ge,[H("button",{class:G(["vuecal__nav vuecal__nav--prev",{"vuecal__nav--default":!Y.$slots["previous-button"]}]),onClick:f[0]||(f[0]=(...$)=>d(n).previous&&d(n).previous(...$)),type:"button"},[_(Y.$slots,"previous-button")],2),H("div",Ke,[oe(ye,{name:`vuecal-slide-fade--${d(n).transitionDirection}`},{default:z(()=>[(u(),m("div",{key:d(n).id+d(n).start.getTime()},[Y.$slots.title?(u(),te(De(d(l).clickToNavigate&&d(n).broaderView?"button":"div"),W({key:0,class:"vuecal__title"},ge(h.value)),{default:z(()=>[_(Y.$slots,"title",V(R(d(n))))]),_:3},16)):(u(),te(De(d(l).clickToNavigate&&d(n).broaderView?"button":"div"),W({key:1,class:"vuecal__title"},ge(h.value),{innerHTML:d(n).title}),null,16,["innerHTML"]))]))]),_:3},8,["name"])]),d(l).todayButton?(u(),m(N,{key:0},[Y.$slots["today-button"]?_(Y.$slots,"today-button",{key:0,navigate:()=>!d(n).containsToday&&d(n).goToToday(),active:d(n).containsToday}):(u(),m("button",{key:1,class:G(["vuecal__nav vuecal__nav--today vuecal__nav--default",{"vuecal__nav--active":d(n).containsToday}]),onClick:f[1]||(f[1]=$=>!d(n).containsToday&&d(n).goToToday()),disabled:!!d(n).containsToday,type:"button",innerHTML:d(D).texts.today},null,10,Qe))],64)):P("",!0),H("button",{class:G(["vuecal__nav vuecal__nav--next",{"vuecal__nav--default":!Y.$slots["next-button"]}]),onClick:f[2]||(f[2]=(...$)=>d(n).next&&d(n).next(...$)),type:"button"},[_(Y.$slots,"next-button")],2)])):P("",!0)],64))]))}},Ze={key:0,class:"vuecal__headings"},xe={key:0,class:"vuecal__weekdays-headings"},et=["onClick"],tt={class:"vuecal__weekday-day"},st={key:0,class:"vuecal__weekday-date"},lt={key:1,class:"vuecal__schedules-headings w-flex grow"},at=["innerHTML"],nt={__name:"headings-bar",setup(J){const D=ve("vuecal"),{view:n,config:l,dateUtils:o}=D,h=k(()=>l.xs?"day-xs":l.sm||n.isDays||n.isMonth?"day-sm":"day"),Y=k(()=>(n.isDay||n.isDays||n.isWeek||n.isMonth)&&!(n.isDay&&!l.schedules)),f=k(()=>n.cellDates.slice(0,n.cols).map(({start:t})=>({id:_e[t.getDay()],date:t,dateNumber:t.getDate(),day:o.formatDate(t,"dddd"),"day-sm":o.formatDate(t,"ddd"),"day-xs":o.formatDate(t,"dd"),isToday:o.isToday(t)}))),$={click:t=>{(n.isDays||n.isWeek)&&n.updateSelectedDate(t)}};return(t,s)=>Y.value?(u(),m("div",Ze,[d(n).isDay?P("",!0):(u(),m("div",xe,[(u(!0),m(N,null,q(f.value,(w,B)=>(u(),m("div",{class:G(["vuecal__weekday",{"vuecal__weekday--today":w.isToday}]),key:B,onClick:X=>$.click(w.date)},[_(t.$slots,"weekday-heading",{label:w[h.value],id:w.id,date:w.date},()=>[H("span",tt,F(w[h.value]),1),d(n).isMonth?P("",!0):(u(),m("strong",st,F(w.dateNumber),1))])],10,et))),128))])),d(l).schedules?(u(),m("div",lt,[(u(!0),m(N,null,q(f.value,(w,B)=>(u(),m(N,{key:B},[(u(!0),m(N,null,q(d(l).schedules,(X,I)=>(u(),m(N,{key:I},[t.$slots["schedule-heading"]?(u(),m("div",{key:0,class:G(["vuecal__schedule vuecal__schedule--heading",X.class])},[_(t.$slots,"schedule-heading",{schedule:X,view:d(n)})],2)):(u(),m("div",{key:1,class:G(["vuecal__schedule vuecal__schedule--heading",X.class]),innerHTML:X.label},null,10,at))],64))),128))],64))),128))])):P("",!0)])):P("",!0)}},ot={class:"vuecal__time-column"},rt={__name:"time-column",setup(J){const D=ve("vuecal"),{config:n,texts:l}=D,o=k(()=>{const h=[];for(let f=n.timeFrom;f<n.timeTo;f+=n.timeStep){const $=~~(f/60),t=f%60,s=l[f<720?"am":"pm"];h.push({minutesSum:f,hours:$,minutes:t,formatted12:`${$%12?$%12:12}${t?":"+t.toString().padStart(2,0):""}${s}`,formatted24:`${$.toString().padStart(2,0)}:${t.toString().padStart(2,0)}`})}return h});return(h,Y)=>(u(),m("div",ot,[(u(!0),m(N,null,q(o.value,(f,$)=>(u(),m("div",{class:"vuecal__time-cell",key:$},[_(h.$slots,"time-cell",{index:$,minutes:f.minutes,hours:f.hours,minutesSum:f.minutesSum,format12:f.formatted12,format24:f.formatted24},()=>[H("label",null,F(d(n).twelveHour?f.formatted12:f.formatted24),1)])]))),128))]))}},it=["draggable"],ut={class:"vuecal__event-details"},ct={class:"vuecal__event-title"},vt={key:0,class:"vuecal__event-time"},dt=["innerHTML"],Ye={__name:"event",props:{event:{type:Object,required:!0}},emits:["event-drag-start","event-drag-end","event-resize-start","event-resize-end"],setup(J,{emit:D}){const{config:n,view:l,dnd:o,touch:h,dateUtils:Y}=ve("vuecal"),f=J,$=ee(null),t=fe(f.event),s=fe({dragging:!1,resizing:!1,fromResizer:!1,holding:!1,holdTimer:null,startX:0,startY:0,startPercentageX:0,startPercentageY:0,moveX:0,moveY:0,movePercentageX:0,movePercentageY:0,resizeStartDate:null,resizingOriginalEvent:null,resizingLastAcceptedEvent:null,cellEl:null,schedule:null}),w=k(()=>n.editableEvents.drag&&t.draggable!==!1&&!t.background),B=k(()=>n.time&&n.editableEvents.resize&&t.resizable!==!1&&!t.background);k(()=>n.editableEvents.delete&&t.deletable!==!1&&!t.background);const X=k(()=>{var y,v,T;return{[`vuecal__event--${t._.id}`]:!0,[t.class]:!!t.class,"vuecal__event--recurring":!!t.recurring,"vuecal__event--background":!!t.background,"vuecal__event--multiday":!!((y=t._)!=null&&y.multiday),"vuecal__event--cut-top":((v=t._)==null?void 0:v.startMinutes)<n.timeFrom,"vuecal__event--cut-bottom":((T=t._)==null?void 0:T.endMinutes)>n.timeTo||t.end.getDate()!==t.start.getDate(),"vuecal__event--dragging":!t._.draggingGhost&&t._.dragging,"vuecal__event--dragging-ghost":t._.draggingGhost,"vuecal__event--resizing":s.resizing}}),I=k(()=>{const y=(l.isDay||l.isDays||l.isWeek)&&n.time;if(!y&&!t.backgroundColor&&!t.color)return!1;const v={backgroundColor:t.backgroundColor||null,color:t.color||null};if(y){const T=Math.max(n.timeFrom,t._.startMinutes),E=Math.min(n.timeTo,t._.endMinutes),C=ne(T,n),L=ne(E,n)-C;v.top=`${C}%`,v.height=`${L}%`}return v}),a=k(()=>{const y={...n.eventListeners.event};Object.entries(y).forEach(([E,C])=>{["resize-end"].includes(E)||(y[E]=L=>{L.type!=="drop"&&C(L.type?{e:L,event:t}:L)})});const v={...y};y.touchstart=E=>{var C;E.stopPropagation(),c(E),(C=v.touchstart)==null||C.call(v,{e:E,event:t})},y.mousedown=E=>{var C;E.stopPropagation(),c(E),(C=v.mousedown)==null||C.call(v,{e:E,event:t})};let T=null;return y.click=E=>{var C;(C=v.click)==null||C.call(v,{e:E,event:t}),T?T=clearTimeout(T):T=setTimeout(()=>{var L;T=null,(L=v["delayed-click"])==null||L.call(v,{e:E,event:t})},400)},y.dblclick=E=>{v.dblclick?v.dblclick({e:E,event:t}):t.delete(1)},y}),c=y=>{var E,C,L;const v=((E=y.touches)==null?void 0:E[0])||y;s.fromResizer=v.target.matches(".vuecal__event-resizer, .vuecal__event-resizer *");const T=$.value.getBoundingClientRect();s.startX=(((C=y.touches)==null?void 0:C[0])||y).clientX-T.left,s.startY=(((L=y.touches)==null?void 0:L[0])||y).clientY-T.top,s.startPercentageX=s.startX*100/T.width,s.startPercentageY=s.startY*100/T.height,s.cellEl=$.value.closest(".vuecal__cell"),s.resizeStartDate=t.start,de(y.type==="touchstart"?"touchmove":"mousemove",j),de(y.type==="touchstart"?"touchend":"mouseup",p,{once:!0}),s.holdTimer=setTimeout(()=>{var O,U;s.holding=!0,(U=(O=a.value).hold)==null||U.call(O,{e:y,event:t})},1e3)},j=async y=>{var T,E,C,L;const v=((T=y.touches)==null?void 0:T[0])||y;if(s.fromResizer&&!s.resizing&&(s.resizing=!0,s.resizingOriginalEvent={...t,_:{...t._}},h.isResizingEvent=!0,(C=(E=a.value).resizeStart)==null||C.call(E,{e:y,event:t})),s.holdTimer=clearTimeout(s.holdTimer),s.holding=!1,s.cellEl){const{top:O,left:U,width:se,height:K}=s.cellEl.getBoundingClientRect();s.moveX=v.clientX-U,s.moveY=v.clientY-O,s.movePercentageX=s.moveX*100/se,s.movePercentageY=s.moveY*100/K}if(s.fromResizer){const{newStart:O,newEnd:U}=ie(t);let se=!0;const{resize:K}=(L=n.eventListeners)==null?void 0:L.event;K&&(se=await K({e:y,event:{...t,start:O,end:U},overlaps:t.getOverlappingEvents({start:O,end:U})})),se!==!1?(t.start=O,t.end=U,s.resizingLastAcceptedEvent&&(s.resizingLastAcceptedEvent=null)):K&&(s.resizingLastAcceptedEvent={...t,_:{...t._}})}},p=async y=>{var v,T;if(s.holdTimer=clearTimeout(s.holdTimer),s.holding=!1,s.resizing){const{newStart:E,newEnd:C}=ie(t);let L=!0;const O=a.value["resize-end"];O&&(L=await O({e:y,event:t,original:s.resizingOriginalEvent,overlaps:t.getOverlappingEvents({start:E,end:C})})),t.start=L===!1?(s.resizingLastAcceptedEvent||s.resizingOriginalEvent).start:((v=s.resizingLastAcceptedEvent)==null?void 0:v.start)||E,t.end=L===!1?(s.resizingLastAcceptedEvent||s.resizingOriginalEvent).end:((T=s.resizingLastAcceptedEvent)==null?void 0:T.end)||C,t._.duration<1&&(t.start=s.resizingOriginalEvent.start,t.end=s.resizingOriginalEvent.end),h.isResizingEvent=!1}document.removeEventListener(y.type==="touchend"?"touchmove":"mousemove",j),s.resizing=!1,s.fromResizer=!1,s.dragging=!1,s.startX=0,s.startY=0,s.moveX=0,s.moveY=0,s.startPercentageX=0,s.startPercentageY=0,s.movePercentageX=0,s.movePercentageY=0,s.cellEl=null,s.resizeStartDate=null,s.resizingOriginalEvent=null,s.resizingLastAcceptedEvent=null,s.schedule=null},ie=y=>{const v=new Date(y.start.getFullYear(),y.start.getMonth(),y.start.getDate());new Date(v).setDate(v.getDate()+1);let E=ce(s.movePercentageY,n);if(E=Math.max(0,Math.min(E,24*60)),n.snapToInterval){const O=E+n.snapToInterval/2;E=O-O%n.snapToInterval}let C=y.start,L=new Date(v.getTime()+E*6e4);return L<s.resizeStartDate&&(C=L,L=s.resizeStartDate),{newStart:C,newEnd:L}};pe(()=>t._.register($.value));const me=[],de=(y,v,T)=>{document.addEventListener(y,v,T),me.push({event:y,handler:v,options:T})};return ke(()=>{t._.unregister(),me.forEach(({event:y,handler:v,options:T})=>{document.removeEventListener(y,v,T)})}),(y,v)=>(u(),m("div",W({class:"vuecal__event"},ge(a.value,!0),{ref_key:"eventEl",ref:$,class:X.value,style:I.value,draggable:w.value?"true":void 0,onDragstart:v[2]||(v[2]=T=>w.value&&d(o).eventDragStart(T,t)),onDragend:v[3]||(v[3]=T=>w.value&&d(o).eventDragEnd(T,t))}),[H("div",ut,[_(y.$slots,"event",{event:t},()=>[H("div",ct,F(t.title),1),d(n).time?(u(),m("div",vt,F(t._[`startTimeFormatted${d(n).twelveHour?12:24}`])+`
- `+F(t._[`endTimeFormatted${d(n).twelveHour?12:24}`]),1)):P("",!0),H("div",{class:"vuecal__event-content",innerHTML:t.content},null,8,dt)])]),B.value?(u(),m("div",{key:0,class:"vuecal__event-resizer",onDragstart:v[0]||(v[0]=Te(()=>{},["prevent","stop"]))},null,32)):P("",!0),oe(ye,{name:"vuecal-delete-btn"},{default:z(()=>[t._.deleting?(u(),m("div",{key:0,class:"vuecal__event-delete",onClick:v[1]||(v[1]=Te(T=>t.delete(3),["stop"]))},"Delete")):P("",!0)]),_:1})],16,it))}},mt=["innerHTML"],gt=["data-schedule"],ft={key:1,class:"vuecal__cell-date"},yt={key:2,class:"vuecal__cell-content"},ht={key:3,class:"vuecal__cell-events"},_t={key:1,class:"vuecal__cell-date"},pt={key:2,class:"vuecal__cell-content"},kt={key:3,class:"vuecal__cell-events"},$t={key:5,class:"vuecal__cell-events-count"},wt=["title"],bt={__name:"cell",props:{start:{type:Date,required:!0},end:{type:Date,required:!0},index:{type:Number,required:!0}},setup(J){const D=J,n=ve("vuecal"),{view:l,config:o,dateUtils:h,eventsManager:Y,dnd:f,touch:$}=n,t=k(()=>h.isToday(D.start)),s=ee(null),w=ee([]),B=ee(!1),X=e=>{w.value.push(e.detail),B.value=!0},I=()=>setTimeout(()=>B.value=!1,300),a=fe({dragging:!1,holding:!1,holdTimer:null,thresholdPassed:!1,startX:0,startY:0,moveX:0,moveY:0,startPercentageX:0,startPercentageY:0,movePercentageX:0,movePercentageY:0,schedule:null}),c=ee(!1),j=ee({cellOverlaps:{},longestStreak:0}),p=k(()=>{let e=Math.min(a.startPercentageY,a.movePercentageY),r=Math.max(a.startPercentageY,a.movePercentageY),g=ce(e,o),i=ce(r,o);return o.snapToInterval&&(g=h.snapToInterval(g,o.snapToInterval),i=h.snapToInterval(i,o.snapToInterval),e=ne(g,o),r=ne(i,o)),{style:{top:`${e}%`,height:`${Math.abs(r-e)}%`},startMinutes:g,endMinutes:i,start:h.formatMinutes(g),end:h.formatMinutes(i),...a.schedule?{schedule:a.schedule}:{}}}),ie=k(()=>{const e=o.editableEvents.create&&(a.dragging||c.value),r=o.eventCreateMinDrag&&a.thresholdPassed||!o.eventCreateMinDrag;return e&&r}),me=k(()=>{var A;const e=new Date,r=l.start.getFullYear(),g=l.start.getMonth(),i=D.start.getFullYear(),b=D.start.getMonth();return{[`vuecal__cell--${_e[D.start.getDay()]}`]:l.isDay||l.isDays||l.isWeek||l.isMonth,[`vuecal__cell--${Fe[b]}`]:l.isYear,[`vuecal__cell--${i}`]:l.isYears,"vuecal__cell--today":t.value,"vuecal__cell--current-month":l.isYear&&i===e.getFullYear()&&b===e.getMonth(),"vuecal__cell--current-year":l.isYears&&i===e.getFullYear(),"vuecal__cell--out-of-range":l.isMonth&&(i!==r||b!==g),"vuecal__cell--before-min":K.value&&U.value,"vuecal__cell--after-max":K.value&&se.value,"vuecal__cell--disabled":K.value,"vuecal__cell--selected":l.selectedDate&&l.selectedDate.getTime()>=D.start.getTime()&&l.selectedDate.getTime()<=D.end.getTime(),"vuecal__cell--has-schedules":(A=o.schedules)==null?void 0:A.length,"vuecal__cell--dragging":a.dragging,"vuecal__cell--has-events":v.value.length}}),de=k(()=>h.formatDate(D.start)),y=k(()=>{switch(l.id){case"day":return"";case"days":return o.availableViews.days.rows>1&&h.formatDate(D.start,"D"),"";case"week":return"";case"month":return h.formatDate(D.start,"D");case"year":return h.formatDate(D.start,o.xs?"MMM":"MMMM");case"years":return h.formatDate(D.start,"YYYY")}}),v=k(()=>o.datePicker?[]:Y.getEventsByDate(de.value,!0,!0).filter(e=>!w.value.includes(e._.id))),T=k(()=>v.value.filter(e=>!e.background)),E=k(()=>{var e;return(e=o.schedules)==null?void 0:e.reduce((r,g)=>(r[g.id]=v.value.filter(i=>i.schedule===g.id),r),{})}),C=k(()=>{const e={};for(const r of v.value){const g=r._.id,{maxConcurrent:i=1,position:b=0}=j.value.cellOverlaps[g]||{};e[g]={width:`${100/i}%`,left:`${100/i*b}%`}}return e}),L=k(()=>l.isMonth&&o.eventCount&&!o.eventsOnMonthView&&T.value.length),O=k(()=>{var g;if(!o.specialHours||l.isMonth||l.isYear||l.isYears)return;const e=_e[D.start.getDay()];let r=(g=o.specialHours)==null?void 0:g[e];if(r)return Array.isArray(r)||(r=[r]),r.map(i=>{let{from:b,to:M,class:A,label:Z}=i;if(isNaN(b)||isNaN(M)||o.timeFrom>=M||o.timeTo<=b)return;b=Math.max(o.timeFrom,b),M=Math.min(o.timeTo,M);const ae=ne(b,o),Xe=ne(M,o)-ae;return{style:{top:`${ae}%`,height:`${Xe}%`},label:Z,class:A}}).filter(i=>!!i)}),U=k(()=>o.minTimestamp!==null&&o.minTimestamp>D.end.getTime()),se=k(()=>o.maxTimestamp&&o.maxTimestamp<D.start.getTime()),K=k(()=>{const{disableDays:e}=o,r=l.isYear||l.isYears;return e.length&&e.includes(h.formatDate(D.start))&&!r?!0:U.value||se.value}),ue=fe({show:k(()=>{if(!(!l.isDay&&!l.isDays&&!l.isWeek)&&!(!t.value||!o.time)&&!(o.timeFrom>h.dateToMinutes(l.now))&&!(h.dateToMinutes(l.now)>o.timeTo))return!0}),nowInMinutes:k(()=>h.dateToMinutes(l.now)),todaysTimePosition:k(()=>ne(ue.nowInMinutes,o)),style:k(()=>`top: ${ue.todaysTimePosition}%`),currentTime:k(()=>h.formatTime(l.now))}),le=k(()=>{if(K.value)return{};const e={...o.eventListeners.cell};for(const[i,b]of Object.entries(e))e[i]=M=>{var A,Z,ae;(ae=(Z=M.target||((A=M.e)==null?void 0:A.target)).closest)!=null&&ae.call(Z,".vuecal__event")||b(M.type?{e:M,cell:S.value,cursor:x.value}:M)};const r={...e};let g=null;return e.click=i=>{var M;ze();const b=$e(i);(M=r.click)==null||M.call(r,{e:i,cell:S.value,cursor:b}),g?g=clearTimeout(g):g=setTimeout(()=>{var A;g=null,(A=r["delayed-click"])==null||A.call(r,{e:i,cell:S.value,cursor:b})},400)},(o.time&&l.isDay||l.isDays||l.isWeek)&&(e.touchstart=i=>{var b;we(i.e||i),(b=r.touchstart)==null||b.call(r,{e:i,cell:S.value,cursor:x.value})},e.mousedown=i=>{var b;we(i.e||i),(b=r.mousedown)==null||b.call(r,{e:i,cell:S.value,cursor:x.value})}),r.dblclick&&(e.dblclick=i=>{var b;(b=r.dblclick)==null||b.call(r,{e:i,cell:S.value,cursor:$e(i)})}),o.editableEvents.drag&&(e.dragenter=i=>f.cellDragEnter(i,S.value),e.dragover=i=>{i.preventDefault(),f.cellDragOver(i,S.value)},e.dragleave=i=>f.cellDragLeave(i,S.value),e.drop=i=>f.cellDragDrop(i,S.value)),e}),S=k(()=>({start:D.start,end:D.end,events:v,...a.schedule?{schedule:a.schedule}:{},goNarrower:()=>l.narrower(),goBroader:()=>l.broader(),broader:l.broaderView,narrower:l.narrowerView})),$e=e=>{var M;const r=(((M=e.touches)==null?void 0:M[0])||e).clientY,{top:g}=s.value.getBoundingClientRect(),i=Pe(r-g,s.value),b=new Date(D.start);return b.setMinutes(ce(i,o)),{y:i,date:b}},x=k(()=>{const e=ce(a.movePercentageY||a.startPercentageY,o),r=new Date(D.start);return r.setMinutes(e),{x:a.movePercentageX||a.startPercentageX,y:a.movePercentageY||a.startPercentageY,date:r}}),ze=()=>{l.updateSelectedDate(D.start),o.clickToNavigate&&((l.isMonth||l.isDays||l.isWeek)&&o.availableViews.day?l.switch("day"):l.isYear&&o.availableViews.month?l.switch("month"):l.isYears&&o.availableViews.year&&l.switch("year")),l.updateViewDate(D.start)},we=e=>{var g,i;a.schedule=~~e.target.dataset.schedule;const r=s.value.getBoundingClientRect();a.startX=(((g=e.touches)==null?void 0:g[0])||e).clientX-r.left,a.startY=(((i=e.touches)==null?void 0:i[0])||e).clientY-r.top,a.startPercentageX=a.startX*100/r.width,a.startPercentageY=a.startY*100/r.height,a.thresholdPassed=!1,document.addEventListener(e.type==="touchstart"?"touchmove":"mousemove",be),document.addEventListener(e.type==="touchstart"?"touchend":"mouseup",Ce,{once:!0}),a.holdTimer=setTimeout(()=>{var b,M;a.holding=!0,(M=(b=le.value).hold)==null||M.call(b,{e,cell:S.value,cursor:x.value})},1e3)},be=e=>{var g,i,b,M,A,Z;a.dragging||($.isDraggingCell=!0,(i=(g=le.value).dragStart)==null||i.call(g,{e,cell:S.value,cursor:x.value})),a.dragging=!0,a.holdTimer=clearTimeout(a.holdTimer),a.holding=!1;const r=s.value.getBoundingClientRect();a.moveX=(((b=e.touches)==null?void 0:b[0])||e).clientX-r.left,a.moveY=(((M=e.touches)==null?void 0:M[0])||e).clientY-r.top,a.movePercentageX=a.moveX*100/r.width,a.movePercentageY=a.moveY*100/r.height,o.eventCreateMinDrag&&Math.abs(a.startY-a.moveY)>o.eventCreateMinDrag&&(a.thresholdPassed=!0),(Z=(A=le.value).drag)==null||Z.call(A,{e,cell:S.value,cursor:x.value})},Ce=async e=>{var r,g;document.removeEventListener(e.type==="touchend"?"touchmove":"mousemove",be,{passive:!1}),a.dragging&&((g=(r=le.value).dragEnd)==null||g.call(r,{e,cell:S.value,cursor:x.value}),$.isDraggingCell=!1,o.editableEvents.create&&(c.value=!0,await Le(e),c.value=!1)),a.holdTimer=clearTimeout(a.holdTimer),a.holding=!1,a.dragging=!1,a.startX=0,a.startY=0,a.moveX=0,a.moveY=0,a.startPercentageX=0,a.startPercentageY=0,a.movePercentageX=0,a.movePercentageY=0,a.thresholdPassed=!1,a.schedule=null},Le=async e=>{if(!ie.value)return;let{start:r,end:g,startMinutes:i,endMinutes:b}=p.value;r=new Date(D.start),r.setMinutes(i),g=new Date(D.start),g.setMinutes(b);let M={...p.value,start:r,end:g};const{create:A}=o.eventListeners.event;if(typeof A=="function"){const Z=M;M=await new Promise(ae=>A({e,event:M,cell:S.value,resolve:ae,cursor:x.value})),M&&typeof M=="object"&&l.createEvent(M),M&&typeof M=="boolean"&&l.createEvent(Z)}else l.createEvent(M)},Se=()=>{var e;for(const r of Object.keys(le.value))(e=s.value)==null||e.removeEventListener(r,le.value[r])},Be=()=>{j.value=Y.getCellOverlappingEvents(de.value)};return Oe(()=>T.value.map(e=>`${e._.id}${e.start.getTime()}${e.end.getTime()}`).join(),async()=>{await he(),Be()},{immediate:!0,flush:"post"}),ke(async()=>{for(const e of w.value)Y.deleteEvent(e,3);Se(),await he()}),(e,r)=>(u(),m("div",W({class:["vuecal__cell",me.value],ref_key:"cellEl",ref:s},ge(le.value,!0)),[e.$slots.cell?_(e.$slots,"cell",{key:0,cell:S.value}):P("",!0),O.value?(u(!0),m(N,{key:1},q(O.value,(g,i)=>(u(),m("div",{class:G(["vuecal__special-hours",g.class]),style:Q(g.style),innerHTML:g.label||""},null,14,mt))),256)):P("",!0),!e.$slots.cell&&d(o).schedules?(u(!0),m(N,{key:2},q(d(o).schedules,g=>(u(),m("div",{class:G(["vuecal__schedule vuecal__schedule--cell",g.class]),key:g.id,style:Q(g.style||null),"data-schedule":g.id},[e.$slots["cell-events"]?_(e.$slots,"cell-events",{key:0,cell:S.value}):P("",!0),y.value||e.$slots["cell-date"]?(u(),m("div",ft,[_(e.$slots,"cell-date",{cell:S.value},()=>[Ee(F(y.value),1)])])):P("",!0),e.$slots["cell-content"]?(u(),m("div",yt,[_(e.$slots,"cell-content",{cell:S.value})])):P("",!0),e.$slots["cell-events"]&&v.value.length?(u(),m("div",ht,[_(e.$slots,"cell-events",{cell:S.value})])):v.value.length||B.value?(u(),te(Me,{key:4,class:"vuecal__cell-events",name:"vuecal-event-delete",onBeforeLeave:r[0]||(r[0]=i=>B.value=!0),onAfterLeave:I,tag:"div"},{default:z(()=>[(u(!0),m(N,null,q(E.value[g.id],i=>(u(),te(Ye,{key:i._.id,event:i,onEventDeleted:X,style:Q(C.value[i._.id])},re({_:2},[e.$slots.event?{name:"event",fn:z(b=>[_(e.$slots,"event",W({ref_for:!0},b))]),key:"0"}:void 0]),1032,["event","style"]))),128))]),_:2},1024)):P("",!0),ie.value&&a.schedule===g.id?(u(),m("div",{key:5,class:"vuecal__event-placeholder",style:Q(p.value.style)},F(p.value.start)+" - "+F(p.value.end),5)):P("",!0)],14,gt))),128)):P("",!0),!e.$slots.cell&&!d(o).schedules?(u(),m(N,{key:3},[e.$slots["cell-events"]?_(e.$slots,"cell-events",{key:0,cell:S.value}):P("",!0),y.value||e.$slots["cell-date"]?(u(),m("div",_t,[_(e.$slots,"cell-date",{cell:S.value},()=>[Ee(F(y.value),1)])])):P("",!0),e.$slots["cell-content"]?(u(),m("div",pt,[_(e.$slots,"cell-content",{cell:S.value})])):P("",!0),e.$slots["cell-events"]&&v.value.length?(u(),m("div",kt,[_(e.$slots,"cell-events",{cell:S.value})])):(v.value.length||B.value)&&!(d(l).isMonth&&!d(o).eventsOnMonthView)?(u(),te(Me,{key:4,class:"vuecal__cell-events",name:"vuecal-event-delete",onBeforeLeave:r[1]||(r[1]=g=>B.value=!0),onAfterLeave:I,tag:"div"},{default:z(()=>[(u(!0),m(N,null,q(v.value,g=>(u(),te(Ye,{key:g._.id,event:g,onEventDeleted:X,style:Q(C.value[g._.id])},re({_:2},[e.$slots.event?{name:"event",fn:z(i=>[_(e.$slots,"event",W({ref_for:!0},i))]),key:"0"}:void 0]),1032,["event","style"]))),128))]),_:3})):P("",!0),ie.value?(u(),m("div",{key:5,class:"vuecal__event-placeholder",style:Q(p.value.style)},F(p.value.start)+" - "+F(p.value.end),5)):P("",!0)],64)):P("",!0),e.$slots["event-count"]?_(e.$slots,"event-count",{key:4,events:T.value}):L.value?(u(),m("div",$t,F(T.value.length),1)):P("",!0),ue.show?(u(),m("div",{key:6,class:"vuecal__now-line",style:Q(ue.style),title:ue.currentTime},[H("span",null,F(ue.currentTime),1)],12,wt)):P("",!0)],16))}},Dt={__name:"body",setup(J){const D=ve("vuecal"),{view:n,config:l,dateUtils:o}=D,h=ee(null),Y=ee(null),f=k(()=>({"--vuecal-grid-columns":n.cols,"--vuecal-grid-rows":n.rows})),$=k(()=>{const w=o.formatTime(ce(Y.value,l));return{style:{top:`${Y.value}%`},time:w}}),t=w=>{var I;if(n.isMonth||n.isYear||n.isYears)return;const B=(((I=w.touches)==null?void 0:I[0])||w).clientY,{top:X}=h.value.getBoundingClientRect();Y.value=Pe(B-X,h.value)},s=()=>{Y.value=null};return pe(()=>{h.value.addEventListener("mousemove",t),h.value.addEventListener("touchmove",t),h.value.addEventListener("mouseleave",s),h.value.addEventListener("touchend",s)}),ke(()=>{h.value&&(h.value.removeEventListener("mousemove",t),h.value.removeEventListener("touchmove",t),h.value.removeEventListener("mouseleave",s),h.value.removeEventListener("touchend",s))}),(w,B)=>(u(),m("div",{class:"vuecal__body",ref_key:"bodyEl",ref:h,style:Q(f.value)},[oe(ye,{name:"vuecal-shrink"},{default:z(()=>[d(l).timeAtCursor&&Y.value!==null?(u(),m("div",{key:0,class:"vuecal__time-at-cursor",style:Q($.value.style)},[H("label",null,F($.value.time),1)],4)):P("",!0)]),_:1}),(u(!0),m(N,null,q(d(n).cellDates,(X,I)=>(u(),te(bt,{key:I,start:X.start,end:X.end,index:I},re({_:2},[w.$slots.cell?{name:"cell",fn:z(a=>[_(w.$slots,"cell",W({ref_for:!0},a))]),key:"0"}:void 0,w.$slots["cell-date"]?{name:"cell-date",fn:z(a=>[_(w.$slots,"cell-date",W({ref_for:!0},a))]),key:"1"}:void 0,w.$slots["cell-content"]?{name:"cell-content",fn:z(a=>[_(w.$slots,"cell-content",W({ref_for:!0},a))]),key:"2"}:void 0,w.$slots["cell-events"]?{name:"cell-events",fn:z(a=>[_(w.$slots,"cell-events",W({ref_for:!0},a))]),key:"3"}:w.$slots.event?{name:"event",fn:z(a=>[_(w.$slots,"event",W({ref_for:!0},a))]),key:"4"}:w.$slots["event-count"]?{name:"event-count",fn:z(a=>[_(w.$slots,"event-count",W({ref_for:!0},a))]),key:"5"}:void 0]),1032,["start","end","index"]))),128))],4))}},Tt=["data-locale"],Et={class:"vuecal__scrollable-wrap"},Mt={key:1,class:"vuecal__week-numbers"},Yt={class:"vuecal__week-number"},Pt={class:"vuecal__body-wrap"},Lt={__name:"index",props:We,emits:["ready","view-change","update:view","update:selectedDate","update:viewDate","update:events","event-delete","event-created","event-dropped"],setup(J,{expose:D,emit:n}){const l=J,o=n,h=Ne("vuecal-el"),Y=Ie({props:l,emit:o,attrs:Ve(),vuecalEl:h,uid:Ae()}),{config:f,view:$,dateUtils:t,touch:s}=Y,w=k(()=>f.time&&($.isDay||$.isDays||$.isWeek)),B=k(()=>Array($.rows).fill().map((c,j)=>t.getWeek(t.addDays($.firstCellDate,7*j)))),X=k(()=>{var c;return{"vuecal--ready":f.ready,[`vuecal--${f.theme}-theme`]:f.theme,[`vuecal--${f.size}`]:!0,"vuecal--date-picker":f.datePicker,"vuecal--dark":f.dark,"vuecal--light":!f.dark,[`vuecal--${$.id}-view`]:!0,"vuecal--view-has-time":w.value,"vuecal--timeless":!f.time,"vuecal--dragging-cell":s.isDraggingCell,"vuecal--dragging-event":s.isDraggingEvent,"vuecal--resizing-event":s.isResizingEvent,"vuecal--has-schedules":(c=f.schedules)==null?void 0:c.length}}),I=k(()=>({"--vuecal-time-cell-height":f.timeCellHeight&&`${f.timeCellHeight}px`})),a=k(()=>{var c,j;return{"vuecal__scrollable--row":w.value||f.weekNumbers&&$.isMonth,[`vuecal__scrollable--${$.id}-view`]:!0,"vuecal__scrollable--has-schedules":(c=f.schedules)==null?void 0:c.length,"vuecal__scrollable--no-schedules":!((j=f.schedules)!=null&&j.length)}});return pe(async()=>{await he(),f.ready=!0,o("ready",{config:f,view:$})}),Re("vuecal",Y),D({view:Y.view}),(c,j)=>(u(),m("div",{class:G(["vuecal",X.value]),ref:"vuecal-el","data-locale":c.locale,style:Q(I.value)},[c.$slots.diy?_(c.$slots,"diy",{key:0,vuecal:d(Y)}):(u(),m(N,{key:1},[oe(Je,null,re({_:2},[c.$slots.header?{name:"header",fn:z(p=>[_(c.$slots,"header",V(R(p)))]),key:"0"}:void 0,!c.$slots.header&&c.$slots["previous-button"]?{name:"previous-button",fn:z(p=>[_(c.$slots,"previous-button",V(R(p)))]),key:"1"}:void 0,!c.$slots.header&&c.$slots["next-button"]?{name:"next-button",fn:z(p=>[_(c.$slots,"next-button",V(R(p)))]),key:"2"}:void 0,!c.$slots.header&&c.$slots["today-button"]?{name:"today-button",fn:z(p=>[_(c.$slots,"today-button",V(R(p)))]),key:"3"}:void 0,!c.$slots.header&&c.$slots.title?{name:"title",fn:z(p=>[_(c.$slots,"title",V(R(p)))]),key:"4"}:void 0,!c.$slots.header&&c.$slots["schedule-heading"]?{name:"schedule-heading",fn:z(p=>[_(c.$slots,"schedule-heading",V(R(p)))]),key:"5"}:void 0]),1024),H("div",Et,[oe(ye,{name:`vuecal-slide-fade--${d($).transitionDirection}`},{default:z(()=>[(u(),m("div",{class:G(["vuecal__scrollable",a.value]),key:d($).id+d($).start.getTime()},[w.value?(u(),te(rt,{key:0},re({_:2},[c.$slots["time-cell"]?{name:"time-cell",fn:z(p=>[_(c.$slots,"time-cell",V(R(p)))]),key:"0"}:void 0]),1024)):P("",!0),d(f).weekNumbers&&d($).isMonth?(u(),m("div",Mt,[(u(!0),m(N,null,q(B.value,p=>(u(),m("div",Yt,[_(c.$slots,"week-number",{},()=>[H("small",null,F(p),1)])]))),256))])):P("",!0),H("div",Pt,[oe(nt,null,re({_:2},[c.$slots["weekday-heading"]?{name:"weekday-heading",fn:z(p=>[_(c.$slots,"weekday-heading",V(R(p)))]),key:"0"}:void 0,c.$slots["schedule-heading"]?{name:"schedule-heading",fn:z(p=>[_(c.$slots,"schedule-heading",V(R(p)))]),key:"1"}:void 0]),1024),oe(Dt,null,re({_:2},[c.$slots.cell?{name:"cell",fn:z(p=>[_(c.$slots,"cell",V(R(p)))]),key:"0"}:void 0,!c.$slots.cell&&c.$slots["cell-date"]?{name:"cell-date",fn:z(p=>[_(c.$slots,"cell-date",V(R(p)))]),key:"1"}:void 0,!c.$slots.cell&&c.$slots["cell-content"]?{name:"cell-content",fn:z(p=>[_(c.$slots,"cell-content",V(R(p)))]),key:"2"}:void 0,!c.$slots.cell&&c.$slots["cell-events"]?{name:"cell-events",fn:z(p=>[_(c.$slots,"cell-events",V(R(p)))]),key:"3"}:void 0,!c.$slots.cell&&c.$slots.event?{name:"event",fn:z(p=>[_(c.$slots,"event",V(R(p)))]),key:"4"}:void 0,!c.$slots.cell&&c.$slots["event-count"]?{name:"event-count",fn:z(p=>[_(c.$slots,"event-count",V(R(p)))]),key:"5"}:void 0]),1024)])],2))]),_:3},8,["name"])])],64))],14,Tt))}};export{Lt as _};
