import{k as de,c as k,b as m,d as i,J as _,p as P,g as v,F as N,C as G,i as J,e as j,f as oe,w as z,z as se,K as Ee,x as U,H as me,L as R,M as F,T as fe,t as I,r as te,v as ge,o as ke,N as Ae,l as Me,D as _e,O as Ce,I as Se,n as x,h as Ye,y as re,P as Pe,Q as Ve,R as Re,S as Fe,U as Ie}from"./index-zTcikSW_.js";import{w as pe,m as ne,p as ce,c as We,d as Le,e as He}from"./index-dpH5mHpP.js";const je=24*60,Ue={clickToNavigate:{type:Boolean,default:void 0},dark:{type:Boolean,default:!1},datePicker:{type:Boolean,default:!1},disableDays:{type:Array,default:()=>[]},editableEvents:{type:[Boolean,Object],default:!1},eventCreateMinDrag:{type:Number,default:15},events:{type:Array,default:()=>[]},eventCount:{type:Boolean,default:!1},eventsOnMonthView:{type:Boolean,default:!1},hideWeekdays:{type:Array,default:()=>[]},hideWeekends:{type:Boolean,default:!1},locale:{type:String,default:""},maxDate:{type:[String,Date],default:""},minDate:{type:[String,Date],default:""},selectedDate:{type:[String,Date],default:""},sm:{type:Boolean,default:!1},specialHours:{type:Object,default:()=>({})},schedules:{type:Array,default:()=>[]},snapToInterval:{type:Number,default:0},startWeekOnSunday:{type:Boolean,default:!1},theme:{type:[String,Boolean],default:"default"},time:{type:Boolean,default:!0},timeAtCursor:{type:Boolean,default:!1},timeCellHeight:{type:Number,default:40},timeFormat:{type:String,default:""},timeFrom:{type:Number,default:0},timeStep:{type:Number,default:60},timeTo:{type:Number,default:je},titleBar:{type:Boolean,default:!0},todayButton:{type:Boolean,default:!0},transitions:{type:Boolean,default:!0},twelveHour:{type:Boolean,default:!1},view:{type:String,default:""},viewDate:{type:[String,Date],default:""},viewDayOffset:{type:Number,default:0},views:{type:[Array,Object],default:["day","days","week","month","year","years"]},viewsBar:{type:Boolean,default:!0},watchRealTime:{type:Boolean,default:!1},weekNumbers:{type:[Boolean,String],default:!1},xs:{type:Boolean,default:!1},minEventWidth:{type:Number,default:0},minScheduleWidth:{type:Number,default:0},overlapsPerTimeStep:{type:Boolean,default:!1},resizeX:{type:Boolean,default:!1},allDayEvents:{type:[Boolean,String],default:!1}},qe={class:"vuecal__header"},Ge={key:0,class:"vuecal__views-bar"},Je=["onClick","innerHTML"],Ke={key:1,class:"vuecal__title-bar"},Qe={class:"vuecal__transition-wrap"},Ze=["disabled","innerHTML"],xe={__name:"header",setup(L){const w=de("vuecal"),{view:a,config:n}=w,o=()=>{n.clickToNavigate&&a.broader()},y=k(()=>n.clickToNavigate?{click:o}:{});return(Y,g)=>(i(),m("div",qe,[_(Y.$slots,"header",{view:v(a),availableViews:v(n).availableViews,vuecal:v(w)}),Y.$slots.header?P("",!0):(i(),m(N,{key:0},[v(n).viewsBar?(i(),m("div",Ge,[(i(!0),m(N,null,G(v(n).availableViews,(p,t)=>(i(),m("button",{class:J(["vuecal__view-button",{"vuecal__view-button--active":v(a).id===t}]),onClick:s=>v(a).switch(t),innerHTML:v(w).texts[t],type:"button"},null,10,Je))),256))])):P("",!0),v(n).titleBar?(i(),m("nav",Ke,[j("button",{class:J(["vuecal__nav vuecal__nav--prev",{"vuecal__nav--default":!Y.$slots["previous-button"]}]),onClick:g[0]||(g[0]=(...p)=>v(a).previous&&v(a).previous(...p)),type:"button"},[_(Y.$slots,"previous-button")],2),j("div",Qe,[oe(fe,{name:`vuecal-slide-fade--${v(a).transitionDirection}`},{default:z(()=>[(i(),m("div",{key:v(a).id+v(a).start.getTime()},[Y.$slots.title?(i(),se(Ee(v(n).clickToNavigate&&v(a).broaderView?"button":"div"),U({key:0,class:"vuecal__title"},me(y.value)),{default:z(()=>[_(Y.$slots,"title",R(F(v(a))))]),_:3},16)):(i(),se(Ee(v(n).clickToNavigate&&v(a).broaderView?"button":"div"),U({key:1,class:"vuecal__title"},me(y.value),{innerHTML:v(a).title}),null,16,["innerHTML"]))]))]),_:3},8,["name"])]),v(n).todayButton?(i(),m(N,{key:0},[Y.$slots["today-button"]?_(Y.$slots,"today-button",{key:0,navigate:()=>!v(a).containsToday&&v(a).goToToday(),active:v(a).containsToday}):(i(),m("button",{key:1,class:J(["vuecal__nav vuecal__nav--today vuecal__nav--default",{"vuecal__nav--active":v(a).containsToday}]),onClick:g[1]||(g[1]=p=>!v(a).containsToday&&v(a).goToToday()),disabled:!!v(a).containsToday,type:"button",innerHTML:v(w).texts.today},null,10,Ze))],64)):P("",!0),j("button",{class:J(["vuecal__nav vuecal__nav--next",{"vuecal__nav--default":!Y.$slots["next-button"]}]),onClick:g[2]||(g[2]=(...p)=>v(a).next&&v(a).next(...p)),type:"button"},[_(Y.$slots,"next-button")],2)])):P("",!0)],64))]))}},et={key:0,class:"vuecal__headings"},tt={key:0,class:"vuecal__weekdays-headings"},st=["onClick"],at={class:"vuecal__weekday-day"},lt={key:0,class:"vuecal__weekday-date"},nt={key:1,class:"vuecal__schedules-headings w-flex grow"},ot=["innerHTML"],rt={__name:"headings-bar",setup(L){const w=de("vuecal"),{view:a,config:n,dateUtils:o}=w,y=k(()=>n.xs?"day-xs":n.sm||a.isDays||a.isMonth?"day-sm":"day"),Y=k(()=>(a.isDay||a.isDays||a.isWeek||a.isMonth)&&!(a.isDay&&!n.schedules)),g=k(()=>a.cellDates.slice(0,a.cols).map(({start:t})=>({id:pe[t.getDay()],date:t,dateNumber:t.getDate(),day:o.formatDate(t,"dddd"),"day-sm":o.formatDate(t,"ddd"),"day-xs":o.formatDate(t,"dd"),isToday:o.isToday(t)}))),p={click:t=>{(a.isDays||a.isWeek)&&a.updateSelectedDate(t)}};return(t,s)=>Y.value?(i(),m("div",et,[v(a).isDay?P("",!0):(i(),m("div",tt,[(i(!0),m(N,null,G(g.value,($,B)=>(i(),m("div",{class:J(["vuecal__weekday",{"vuecal__weekday--today":$.isToday}]),key:B,onClick:X=>p.click($.date)},[_(t.$slots,"weekday-heading",{label:$[y.value],id:$.id,date:$.date},()=>[j("span",at,I($[y.value]),1),v(a).isMonth?P("",!0):(i(),m("strong",lt,I($.dateNumber),1))])],10,st))),128))])),v(n).schedules?(i(),m("div",nt,[(i(!0),m(N,null,G(g.value,($,B)=>(i(),m(N,{key:B},[(i(!0),m(N,null,G(v(n).schedules,(X,H)=>(i(),m(N,{key:H},[t.$slots["schedule-heading"]?(i(),m("div",{key:0,class:J(["vuecal__schedule vuecal__schedule--heading",X.class])},[_(t.$slots,"schedule-heading",{schedule:X,view:v(a)})],2)):(i(),m("div",{key:1,class:J(["vuecal__schedule vuecal__schedule--heading",X.class]),innerHTML:X.label},null,10,ot))],64))),128))],64))),128))])):P("",!0)])):P("",!0)}},it={class:"vuecal__time-column"},ut={__name:"time-column",setup(L){const w=de("vuecal"),{config:a,texts:n}=w,o=k(()=>{const y=[];for(let g=a.timeFrom;g<a.timeTo;g+=a.timeStep){const p=~~(g/60),t=g%60,s=n[g<720?"am":"pm"];y.push({minutesSum:g,hours:p,minutes:t,formatted12:`${p%12?p%12:12}${t?":"+t.toString().padStart(2,0):""}${s}`,formatted24:`${p.toString().padStart(2,0)}:${t.toString().padStart(2,0)}`})}return y});return(y,Y)=>(i(),m("div",it,[(i(!0),m(N,null,G(o.value,(g,p)=>(i(),m("div",{class:"vuecal__time-cell",key:p},[_(y.$slots,"time-cell",{index:p,minutes:g.minutes,hours:g.hours,minutesSum:g.minutesSum,format12:g.formatted12,format24:g.formatted24},()=>[j("label",null,I(v(a).twelveHour?g.formatted12:g.formatted24),1)])]))),128))]))}},ct=["draggable"],dt={class:"vuecal__event-details"},vt={class:"vuecal__event-title"},mt={key:0,class:"vuecal__event-time"},gt=["innerHTML"],ze={__name:"event",props:{event:{type:Object,required:!0}},emits:["event-drag-start","event-drag-end","event-resize-start","event-resize-end"],setup(L,{emit:w}){const{config:a,view:n,dnd:o,touch:y,dateUtils:Y}=de("vuecal"),g=L,p=te(null),t=ge(g.event),s=ge({dragging:!1,resizing:!1,fromResizer:!1,holding:!1,holdTimer:null,startX:0,startY:0,startPercentageX:0,startPercentageY:0,moveX:0,moveY:0,movePercentageX:0,movePercentageY:0,resizeStartDate:null,resizingOriginalEvent:null,resizingLastAcceptedEvent:null,cellEl:null,schedule:null}),$=k(()=>a.editableEvents.drag&&t.draggable!==!1&&!t.background),B=k(()=>a.time&&a.editableEvents.resize&&t.resizable!==!1&&!t.background);k(()=>a.editableEvents.delete&&t.deletable!==!1&&!t.background);const X=k(()=>{var h,d,M;return{[`vuecal__event--${t._.id}`]:!0,[t.class]:!!t.class,"vuecal__event--recurring":!!t.recurring,"vuecal__event--background":!!t.background,"vuecal__event--multiday":!!((h=t._)!=null&&h.multiday),"vuecal__event--cut-top":((d=t._)==null?void 0:d.startMinutes)<a.timeFrom,"vuecal__event--cut-bottom":((M=t._)==null?void 0:M.endMinutes)>a.timeTo||t.end.getDate()!==t.start.getDate(),"vuecal__event--dragging":!t._.draggingGhost&&t._.dragging,"vuecal__event--dragging-ghost":t._.draggingGhost,"vuecal__event--resizing":s.resizing}}),H=k(()=>{const h=(n.isDay||n.isDays||n.isWeek)&&a.time;if(!h&&!t.backgroundColor&&!t.color)return!1;const d={backgroundColor:t.backgroundColor||null,color:t.color||null};if(h){const M=Math.max(a.timeFrom,t._.startMinutes),T=Math.min(a.timeTo,t._.endMinutes),C=ne(M,a),S=ne(T,a)-C;d.top=`${C}%`,d.height=`${S}%`}return d}),l=k(()=>{const h={...a.eventListeners.event};Object.entries(h).forEach(([T,C])=>{["resize-end"].includes(T)||(h[T]=S=>{S.type!=="drop"&&C(S.type?{e:S,event:t}:S)})});const d={...h};h.touchstart=T=>{var C;T.stopPropagation(),(C=d.touchstart)==null||C.call(d,{e:T,event:t})},h.mousedown=T=>{var C;T.stopPropagation(),c(T),(C=d.mousedown)==null||C.call(d,{e:T,event:t})};let M=null;return h.click=T=>{var C;(C=d.click)==null||C.call(d,{e:T,event:t}),M?M=clearTimeout(M):M=setTimeout(()=>{var S;M=null,(S=d["delayed-click"])==null||S.call(d,{e:T,event:t})},400)},h.dblclick=T=>{d.dblclick?d.dblclick({e:T,event:t}):t.delete(1)},h}),c=h=>{var T,C,S;const d=((T=h.touches)==null?void 0:T[0])||h;s.fromResizer=d.target.matches(".vuecal__event-resizer, .vuecal__event-resizer *");const M=p.value.getBoundingClientRect();s.startX=(((C=h.touches)==null?void 0:C[0])||h).clientX-M.left,s.startY=(((S=h.touches)==null?void 0:S[0])||h).clientY-M.top,s.startPercentageX=s.startX*100/M.width,s.startPercentageY=s.startY*100/M.height,s.cellEl=p.value.closest(".vuecal__cell"),s.resizeStartDate=t.start,document.addEventListener(h.type==="touchstart"?"touchmove":"mousemove",O),document.addEventListener(h.type==="touchstart"?"touchend":"mouseup",b,{once:!0}),s.holdTimer=setTimeout(()=>{var A,K;s.holding=!0,(K=(A=l.value).hold)==null||K.call(A,{e:h,event:t})},1e3)},O=async h=>{var M,T,C,S;const d=((M=h.touches)==null?void 0:M[0])||h;if(s.fromResizer&&!s.resizing&&(s.resizing=!0,s.resizingOriginalEvent={...t,_:{...t._}},y.isResizingEvent=!0,(C=(T=l.value).resizeStart)==null||C.call(T,{e:h,event:t})),s.holdTimer=clearTimeout(s.holdTimer),s.holding=!1,s.cellEl){const{top:A,left:K,width:ae,height:ee}=s.cellEl.getBoundingClientRect();s.moveX=d.clientX-K,s.moveY=d.clientY-A,s.movePercentageX=s.moveX*100/ae,s.movePercentageY=s.moveY*100/ee}if(s.fromResizer){const{newStart:A,newEnd:K}=ie(t);let ae=!0;const{resize:ee}=(S=a.eventListeners)==null?void 0:S.event;ee&&(ae=await ee({e:h,event:{...t,start:A,end:K},overlaps:t.getOverlappingEvents({start:A,end:K})})),ae!==!1?(t.start=A,t.end=K,s.resizingLastAcceptedEvent&&(s.resizingLastAcceptedEvent=null)):ee&&(s.resizingLastAcceptedEvent={...t,_:{...t._}})}},b=async h=>{var d,M;if(s.holdTimer=clearTimeout(s.holdTimer),s.holding=!1,s.resizing){const{newStart:T,newEnd:C}=ie(t);let S=!0;const A=l.value["resize-end"];A&&(S=await A({e:h,event:t,original:s.resizingOriginalEvent,overlaps:t.getOverlappingEvents({start:T,end:C})})),t.start=S===!1?(s.resizingLastAcceptedEvent||s.resizingOriginalEvent).start:((d=s.resizingLastAcceptedEvent)==null?void 0:d.start)||T,t.end=S===!1?(s.resizingLastAcceptedEvent||s.resizingOriginalEvent).end:((M=s.resizingLastAcceptedEvent)==null?void 0:M.end)||C,t._.duration<1&&(t.start=s.resizingOriginalEvent.start,t.end=s.resizingOriginalEvent.end),y.isResizingEvent=!1}document.removeEventListener(h.type==="touchmove"?"touchmove":"mousemove",O),s.resizing=!1,s.fromResizer=!1,s.dragging=!1,s.startX=0,s.startY=0,s.moveX=0,s.moveY=0,s.startPercentageX=0,s.startPercentageY=0,s.movePercentageX=0,s.movePercentageY=0,s.cellEl=null,s.resizeStartDate=null,s.resizingOriginalEvent=null,s.resizingLastAcceptedEvent=null,s.schedule=null},ye=()=>{p.value.dispatchEvent(new CustomEvent("event-deleted",{detail:t._.id}))},ie=h=>{const d=new Date(h.start.getFullYear(),h.start.getMonth(),h.start.getDate());new Date(d).setDate(d.getDate()+1);let T=ce(s.movePercentageY,a);if(T=Math.max(0,Math.min(T,24*60)),a.snapToInterval){const A=T+a.snapToInterval/2;T=A-A%a.snapToInterval}let C=h.start,S=new Date(d.getTime()+T*6e4);return S<s.resizeStartDate&&(C=S,S=s.resizeStartDate),{newStart:C,newEnd:S}};return ke(()=>t._.register(p.value)),Ae(()=>t._.unregister()),(h,d)=>(i(),m("div",U({class:"vuecal__event"},me(l.value,!0),{ref_key:"eventEl",ref:p,class:X.value,style:H.value,draggable:$.value,onDragstart:d[1]||(d[1]=M=>$.value&&v(o).eventDragStart(M,t)),onDragend:d[2]||(d[2]=M=>$.value&&v(o).eventDragEnd(M,t))}),[j("div",dt,[_(h.$slots,"event",{event:t},()=>[j("div",vt,I(t.title),1),v(a).time?(i(),m("div",mt,I(t._[`startTimeFormatted${v(a).twelveHour?12:24}`])+`
- `+I(t._[`endTimeFormatted${v(a).twelveHour?12:24}`]),1)):P("",!0),j("div",{class:"vuecal__event-content",innerHTML:t.content},null,8,gt)])]),B.value?(i(),m("div",{key:0,class:"vuecal__event-resizer",onDragstart:d[0]||(d[0]=Me(()=>{},["prevent","stop"]))},null,32)):P("",!0),oe(fe,{name:"vuecal-delete-btn"},{default:z(()=>[t._.deleting?(i(),m("div",{key:0,class:"vuecal__event-delete",onClick:Me(ye,["stop"])},"Delete")):P("",!0)]),_:1})],16,ct))}},ft=["innerHTML"],yt=["data-schedule"],ht={key:1,class:"vuecal__cell-date"},_t={key:2,class:"vuecal__cell-content"},pt={key:3,class:"vuecal__cell-events"},kt={key:1,class:"vuecal__cell-date"},$t={key:2,class:"vuecal__cell-content"},wt={key:3,class:"vuecal__cell-events"},bt={key:5,class:"vuecal__cell-events-count"},Dt=["title"],Tt={__name:"cell",props:{start:{type:Date,required:!0},end:{type:Date,required:!0},index:{type:Number,required:!0}},setup(L){const w=L,a=de("vuecal"),{view:n,config:o,dateUtils:y,eventsManager:Y,dnd:g,touch:p}=a,t=k(()=>y.isToday(w.start)),s=te(null),$=te([]),B=te(!1),X=e=>{$.value.push(e.detail),B.value=!0},H=()=>setTimeout(()=>B.value=!1,300),l=ge({dragging:!1,holding:!1,holdTimer:null,thresholdPassed:!1,startX:0,startY:0,moveX:0,moveY:0,startPercentageX:0,startPercentageY:0,movePercentageX:0,movePercentageY:0,schedule:null}),c=te(!1),O=k(()=>{let e=Math.min(l.startPercentageY,l.movePercentageY),r=Math.max(l.startPercentageY,l.movePercentageY),f=ce(e,o),u=ce(r,o);return o.snapToInterval&&(f=y.snapToInterval(f,o.snapToInterval),u=y.snapToInterval(u,o.snapToInterval),e=ne(f,o),r=ne(u,o)),{style:{top:e+"%",height:Math.abs(r-e)+"%"},startMinutes:f,endMinutes:u,start:y.formatMinutes(f),end:y.formatMinutes(u),...l.schedule?{schedule:l.schedule}:{}}}),b=k(()=>{const e=o.editableEvents.create&&(l.dragging||c.value),r=o.eventCreateMinDrag&&l.thresholdPassed||!o.eventCreateMinDrag;return e&&r}),ye=k(()=>{var V;const e=new Date,r=n.start.getFullYear(),f=n.start.getMonth(),u=w.start.getFullYear(),D=w.start.getMonth();return{[`vuecal__cell--${pe[w.start.getDay()]}`]:n.isDay||n.isDays||n.isWeek||n.isMonth,[`vuecal__cell--${We[D]}`]:n.isYear,[`vuecal__cell--${u}`]:n.isYears,"vuecal__cell--today":t.value,"vuecal__cell--current-month":n.isYear&&u===e.getFullYear()&&D===e.getMonth(),"vuecal__cell--current-year":n.isYears&&u===e.getFullYear(),"vuecal__cell--out-of-range":n.isMonth&&(u!==r||D!==f),"vuecal__cell--before-min":ve.value&&ee.value,"vuecal__cell--after-max":ve.value&&$e.value,"vuecal__cell--disabled":ve.value,"vuecal__cell--selected":n.selectedDate&&n.selectedDate.getTime()>=w.start.getTime()&&n.selectedDate.getTime()<=w.end.getTime(),"vuecal__cell--has-schedules":(V=o.schedules)==null?void 0:V.length,"vuecal__cell--dragging":l.dragging,"vuecal__cell--has-events":d.value.length}}),ie=k(()=>y.formatDate(w.start)),h=k(()=>{switch(console.log("recomputing cell"),n.id){case"day":return"";case"days":return o.availableViews.days.rows>1&&y.formatDate(w.start,"D"),"";case"week":return"";case"month":return y.formatDate(w.start,"D");case"year":return y.formatDate(w.start,o.xs?"MMM":"MMMM");case"years":return y.formatDate(w.start,"YYYY")}}),d=k(()=>o.datePicker?[]:Y.getEventsByDate(ie.value,!0,!0).filter(e=>!$.value.includes(e._.id))),M=k(()=>d.value.filter(e=>!e.background)),T=k(()=>{var e;return(e=o.schedules)==null?void 0:e.reduce((r,f)=>(r[f.id]=d.value.filter(u=>u.schedule===f.id),r),{})}),C=te({cellOverlaps:{},longestStreak:0});_e(()=>M.value.map(e=>`${e._.id} ${e.start.getTime()} ${e.end.getTime()}`).join(),()=>{C.value=Y.getCellOverlappingEvents(ie.value)},{immediate:!0});const S=k(()=>{const e={};for(const r of d.value){const f=r._.id,{maxConcurrent:u=1,position:D=0}=C.value.cellOverlaps[f]||{};e[f]={width:`${100/u}%`,left:`${100/u*D}%`}}return e}),A=()=>{C.value=Y.getCellOverlappingEvents(ie.value)},K=k(()=>n.isMonth&&o.eventCount&&!o.eventsOnMonthView&&M.value.length),ae=k(()=>{var f;if(!o.specialHours||n.isMonth||n.isYear||n.isYears)return;const e=pe[w.start.getDay()];let r=(f=o.specialHours)==null?void 0:f[e];if(r)return Array.isArray(r)||(r=[r]),r.map(u=>{let{from:D,to:E,class:V,label:q}=u;if(isNaN(D)||isNaN(E)||o.timeFrom>=E||o.timeTo<=D)return;D=Math.max(o.timeFrom,D),E=Math.min(o.timeTo,E);const Z=ne(D,o),he=ne(E,o)-Z;return{style:{top:`${Z}%`,height:`${he}%`},label:q,class:V}}).filter(u=>!!u)}),ee=k(()=>o.minTimestamp!==null&&o.minTimestamp>w.end.getTime()),$e=k(()=>o.maxTimestamp&&o.maxTimestamp<w.start.getTime()),ve=k(()=>{const{disableDays:e}=o,r=n.isYear||n.isYears;return e.length&&e.includes(y.formatDate(w.start))&&!r?!0:ee.value||$e.value}),ue=ge({show:k(()=>{if(!(!n.isDay&&!n.isDays&&!n.isWeek)&&!(!t.value||!o.time)&&!(o.timeFrom>y.dateToMinutes(n.now))&&!(y.dateToMinutes(n.now)>o.timeTo))return!0}),nowInMinutes:k(()=>y.dateToMinutes(n.now)),todaysTimePosition:k(()=>ne(ue.nowInMinutes,o)),style:k(()=>`top: ${ue.todaysTimePosition}%`),currentTime:k(()=>y.formatTime(n.now))}),le=k(()=>{if(ve.value)return{};const e={...o.eventListeners.cell};Object.entries(e).forEach(([u,D])=>{e[u]=E=>{var V,q,Z;(Z=(q=E.target||((V=E.e)==null?void 0:V.target)).closest)!=null&&Z.call(q,".vuecal__event")||D(E.type?{e:E,cell:W.value,cursor:Q.value}:E)}});const r={...e};let f=null;return e.click=u=>{var D;Be(),(D=r.click)==null||D.call(r,{e:u,cell:W.value,cursor:Q.value}),f?f=clearTimeout(f):f=setTimeout(()=>{var E;f=null,(E=r["delayed-click"])==null||E.call(r,{e:u,cell:W.value,cursor:Q.value})},400)},(o.time&&n.isDay||n.isDays||n.isWeek)&&(e.touchstart=u=>{var D;we(u.e||u),(D=r.touchstart)==null||D.call(r,{e:u,cell:W.value,cursor:Q.value})},e.mousedown=u=>{var D;we(u.e||u),(D=r.mousedown)==null||D.call(r,{e:u,cell:W.value,cursor:Q.value})}),r.dblclick&&(e.dblclick=u=>{var De,Te;const D=(((De=u.touches)==null?void 0:De[0])||u).clientY,{top:E}=s.value.getBoundingClientRect(),V=Le(D-E,s.value),q=ce(V,o),Z=new Date(w.start);Z.setMinutes(q);const he={y:V,date:Z};(Te=r.dblclick)==null||Te.call(r,{e:u,cell:W.value,cursor:he})}),o.editableEvents.drag&&(e.dragenter=u=>g.cellDragEnter(u,W.value),e.dragover=u=>g.cellDragOver(u,W.value),e.dragleave=u=>g.cellDragLeave(u,W.value),e.drop=u=>g.cellDragDrop(u,W.value)),e}),W=k(()=>({start:w.start,end:w.end,events:d,...l.schedule?{schedule:l.schedule}:{}})),Q=k(()=>{const e=ce(l.movePercentageY||l.startPercentageY,o),r=new Date(w.start);return r.setMinutes(e),{x:l.movePercentageX||l.startPercentageX,y:l.movePercentageY||l.startPercentageY,date:r}}),Be=()=>{n.updateSelectedDate(w.start),o.clickToNavigate&&((n.isMonth||n.isDays||n.isWeek)&&o.availableViews.day?n.switch("day"):n.isYear&&o.availableViews.month?n.switch("month"):n.isYears&&o.availableViews.year&&n.switch("year")),n.updateViewDate(w.start)},we=e=>{var f,u;l.schedule=~~e.target.dataset.schedule;const r=s.value.getBoundingClientRect();l.startX=(((f=e.touches)==null?void 0:f[0])||e).clientX-r.left,l.startY=(((u=e.touches)==null?void 0:u[0])||e).clientY-r.top,l.startPercentageX=l.startX*100/r.width,l.startPercentageY=l.startY*100/r.height,l.thresholdPassed=!1,document.addEventListener(e.type==="touchstart"?"touchmove":"mousemove",be),document.addEventListener(e.type==="touchstart"?"touchend":"mouseup",Xe,{once:!0}),l.holdTimer=setTimeout(()=>{var D,E;l.holding=!0,(E=(D=le.value).hold)==null||E.call(D,{e,cell:W.value,cursor:Q.value})},1e3)},be=e=>{var f,u,D,E,V,q;l.dragging||(p.isDraggingCell=!0,(u=(f=le.value).dragStart)==null||u.call(f,{e,cell:W.value,cursor:Q.value})),l.dragging=!0,l.holdTimer=clearTimeout(l.holdTimer),l.holding=!1;const r=s.value.getBoundingClientRect();l.moveX=(((D=e.touches)==null?void 0:D[0])||e).clientX-r.left,l.moveY=(((E=e.touches)==null?void 0:E[0])||e).clientY-r.top,l.movePercentageX=l.moveX*100/r.width,l.movePercentageY=l.moveY*100/r.height,o.eventCreateMinDrag&&Math.abs(l.startY-l.moveY)>o.eventCreateMinDrag&&(l.thresholdPassed=!0),(q=(V=le.value).drag)==null||q.call(V,{e,cell:W.value,cursor:Q.value})},Xe=async e=>{var r,f;document.removeEventListener(e.type==="touchend"?"touchmove":"mousemove",be,{passive:!1}),l.dragging&&((f=(r=le.value).dragEnd)==null||f.call(r,{e,cell:W.value,cursor:Q.value}),p.isDraggingCell=!1,o.editableEvents.create&&(c.value=!0,await Oe(e),c.value=!1)),l.holdTimer=clearTimeout(l.holdTimer),l.holding=!1,l.dragging=!1,l.startX=0,l.startY=0,l.moveX=0,l.moveY=0,l.startPercentageX=0,l.startPercentageY=0,l.movePercentageX=0,l.movePercentageY=0,l.thresholdPassed=!1,l.schedule=null},Oe=async e=>{if(!b.value)return;let{start:r,end:f,startMinutes:u,endMinutes:D}=O.value;r=new Date(w.start),r.setMinutes(u),f=new Date(w.start),f.setMinutes(D);let E={...O.value,start:r,end:f};const{create:V}=o.eventListeners.event;if(typeof V=="function"){const q=E;E=await new Promise(Z=>V({e,event:E,cell:W.value,resolve:Z,cursor:Q.value})),E&&typeof E=="object"&&n.createEvent(E),E&&typeof E=="boolean"&&n.createEvent(q)}else n.createEvent(E)},Ne=()=>{Object.keys(le.value).forEach(e=>{var r;(r=s.value)==null||r.removeEventListener(e,le.value[e])})};return _e(M.value,A,{deep:!0}),Ce(async()=>{$.value.forEach(e=>Y.deleteEvent(e,3)),Ne(),await Se()}),(e,r)=>(i(),m("div",U({class:["vuecal__cell",ye.value],ref_key:"cellEl",ref:s},me(le.value,!0)),[e.$slots.cell?_(e.$slots,"cell",{key:0,start:L.start,end:L.end,index:L.index,events:d.value}):P("",!0),ae.value?(i(!0),m(N,{key:1},G(ae.value,(f,u)=>(i(),m("div",{class:J(["vuecal__special-hours",f.class]),style:x(f.style),innerHTML:f.label||""},null,14,ft))),256)):P("",!0),!e.$slots.cell&&v(o).schedules?(i(!0),m(N,{key:2},G(v(o).schedules,f=>(i(),m("div",{class:J(["vuecal__schedule vuecal__schedule--cell",f.class]),key:f.id,style:x(f.style||null),"data-schedule":f.id},[e.$slots["cell-events"]?_(e.$slots,"cell-events",{key:0,start:L.start,end:L.end,events:d.value}):P("",!0),h.value||e.$slots["cell-date"]?(i(),m("div",ht,[_(e.$slots,"cell-date",{start:L.start,end:L.end,events:d.value},()=>[Ye(I(h.value),1)])])):P("",!0),e.$slots["cell-content"]?(i(),m("div",_t,[_(e.$slots,"cell-content",{start:L.start,end:L.end,events:d.value})])):P("",!0),e.$slots["cell-events"]&&d.value.length?(i(),m("div",pt,[_(e.$slots,"cell-events",{start:L.start,end:L.end,events:d.value})])):d.value.length||B.value?(i(),se(Pe,{key:4,class:"vuecal__cell-events",name:"vuecal-event-delete",onBeforeLeave:r[0]||(r[0]=u=>B.value=!0),onAfterLeave:H,tag:"div"},{default:z(()=>[(i(!0),m(N,null,G(T.value[f.id],u=>(i(),se(ze,{key:u._.id,event:u,onEventDeleted:X,style:x(S.value[u._.id])},re({_:2},[e.$slots.event?{name:"event",fn:z(D=>[_(e.$slots,"event",U({ref_for:!0},D))]),key:"0"}:void 0]),1032,["event","style"]))),128))]),_:2},1024)):P("",!0),b.value&&l.schedule===f.id?(i(),m("div",{key:5,class:"vuecal__event-placeholder",style:x(O.value.style)},I(O.value.start)+" - "+I(O.value.end),5)):P("",!0)],14,yt))),128)):P("",!0),!e.$slots.cell&&!v(o).schedules?(i(),m(N,{key:3},[e.$slots["cell-events"]?_(e.$slots,"cell-events",{key:0}):P("",!0),h.value||e.$slots["cell-date"]?(i(),m("div",kt,[_(e.$slots,"cell-date",{start:L.start,end:L.end,events:d.value},()=>[Ye(I(h.value),1)])])):P("",!0),e.$slots["cell-content"]?(i(),m("div",$t,[_(e.$slots,"cell-content",{start:L.start,end:L.end,events:d.value})])):P("",!0),e.$slots["cell-events"]&&d.value.length?(i(),m("div",wt,[_(e.$slots,"cell-events",{start:L.start,end:L.end,events:d.value})])):(d.value.length||B.value)&&!(v(n).isMonth&&!v(o).eventsOnMonthView)?(i(),se(Pe,{key:4,class:"vuecal__cell-events",name:"vuecal-event-delete",onBeforeLeave:r[1]||(r[1]=f=>B.value=!0),onAfterLeave:H,tag:"div"},{default:z(()=>[(i(!0),m(N,null,G(d.value,f=>(i(),se(ze,{key:f._.id,event:f,onEventDeleted:X,style:x(S.value[f._.id])},re({_:2},[e.$slots.event?{name:"event",fn:z(u=>[_(e.$slots,"event",U({ref_for:!0},u))]),key:"0"}:void 0]),1032,["event","style"]))),128))]),_:3})):P("",!0),b.value?(i(),m("div",{key:5,class:"vuecal__event-placeholder",style:x(O.value.style)},I(O.value.start)+" - "+I(O.value.end),5)):P("",!0)],64)):P("",!0),e.$slots["event-count"]?_(e.$slots,"event-count",{key:4,events:M.value}):K.value?(i(),m("div",bt,I(M.value.length),1)):P("",!0),ue.show?(i(),m("div",{key:6,class:"vuecal__now-line",style:x(ue.style),title:ue.currentTime},[j("span",null,I(ue.currentTime),1)],12,Dt)):P("",!0)],16))}},Et={__name:"body",setup(L){const w=de("vuecal");let{view:a,config:n,dateUtils:o}=w;const y=te(null),Y=te(null),g=k(()=>(console.log("recomputing bodyStyles",a.id),{"--vuecal-grid-columns":a.cols,"--vuecal-grid-rows":a.rows})),p=k(()=>{const $=o.formatTime(ce(Y.value,n));return{style:{top:Y.value+"%"},time:$}}),t=$=>{var H;if(a.isMonth||a.isYear||a.isYears)return;const B=(((H=$.touches)==null?void 0:H[0])||$).clientY,{top:X}=y.value.getBoundingClientRect();Y.value=Le(B-X,y.value)},s=()=>{Y.value=null};return ke(()=>{y.value.addEventListener("mousemove",t),y.value.addEventListener("touchmove",t),y.value.addEventListener("mouseleave",s),y.value.addEventListener("touchend",s)}),Ce(()=>{y.value&&(y.value.removeEventListener("mousemove",t),y.value.removeEventListener("touchmove",t),y.value.removeEventListener("mouseleave",s),y.value.removeEventListener("touchend",s))}),($,B)=>(i(),m("div",{class:"vuecal__body",ref_key:"bodyEl",ref:y,style:x(g.value)},[oe(fe,{name:"vuecal-shrink"},{default:z(()=>[v(n).timeAtCursor&&Y.value!==null?(i(),m("div",{key:0,class:"vuecal__time-at-cursor",style:x(p.value.style)},[j("label",null,I(p.value.time),1)],4)):P("",!0)]),_:1}),(i(!0),m(N,null,G(v(a).cellDates,(X,H)=>(i(),se(Tt,{key:H,start:X.start,end:X.end,index:H},re({_:2},[$.$slots.cell?{name:"cell",fn:z(l=>[_($.$slots,"cell",U({ref_for:!0},l))]),key:"0"}:void 0,$.$slots["cell-date"]?{name:"cell-date",fn:z(l=>[_($.$slots,"cell-date",U({ref_for:!0},l))]),key:"1"}:void 0,$.$slots["cell-content"]?{name:"cell-content",fn:z(l=>[_($.$slots,"cell-content",U({ref_for:!0},l))]),key:"2"}:void 0,$.$slots["cell-events"]?{name:"cell-events",fn:z(l=>[_($.$slots,"cell-events",U({ref_for:!0},l))]),key:"3"}:$.$slots.event?{name:"event",fn:z(l=>[_($.$slots,"event",U({ref_for:!0},l))]),key:"4"}:$.$slots["event-count"]?{name:"event-count",fn:z(l=>[_($.$slots,"event-count",U({ref_for:!0},l))]),key:"5"}:void 0]),1032,["start","end","index"]))),128))],4))}},Mt=["data-locale"],Yt={class:"vuecal__scrollable-wrap"},Pt={key:1,class:"vuecal__week-numbers"},zt={class:"vuecal__week-number"},Ct={class:"vuecal__body-wrap"},Bt={__name:"index",props:Ue,emits:["ready","view-change","update:view","update:selectedDate","update:viewDate","update:events","event-delete","event-created","event-dropped","event-change"],setup(L,{expose:w,emit:a}){const n=L,o=a,y=Ve("vuecal-el"),Y=He({props:n,emit:o,attrs:Fe(),vuecalEl:y,uid:Re()}),{config:g,view:p,dateUtils:t,touch:s}=Y,$=k(()=>g.time&&(p.isDay||p.isDays||p.isWeek)),B=k(()=>Array(p.rows).fill().map((c,O)=>t.getWeek(t.addDays(p.firstCellDate,7*O)))),X=k(()=>{var c;return{"vuecal--ready":g.ready,[`vuecal--${g.theme}-theme`]:g.theme,[`vuecal--${g.size}`]:!0,"vuecal--date-picker":g.datePicker,"vuecal--dark":g.dark,"vuecal--light":!g.dark,[`vuecal--${p.id}-view`]:!0,"vuecal--view-has-time":$.value,"vuecal--timeless":!g.time,"vuecal--dragging-cell":s.isDraggingCell,"vuecal--dragging-event":s.isDraggingEvent,"vuecal--resizing-event":s.isResizingEvent,"vuecal--has-schedules":(c=g.schedules)==null?void 0:c.length}}),H=k(()=>({"--vuecal-time-cell-height":g.timeCellHeight&&`${g.timeCellHeight}px`})),l=k(()=>{var c,O;return{"vuecal__scrollable--row":$.value||g.weekNumbers&&p.isMonth,[`vuecal__scrollable--${p.id}-view`]:!0,"vuecal__scrollable--has-schedules":(c=g.schedules)==null?void 0:c.length,"vuecal__scrollable--no-schedules":!((O=g.schedules)!=null&&O.length)}});return ke(async()=>{await Se(),o("ready",{config:g,view:p})}),_e(()=>g.locale,c=>g.loadTexts(c)),Ie("vuecal",Y),w({view:Y.view}),(c,O)=>(i(),m("div",{class:J(["vuecal",X.value]),ref:"vuecal-el","data-locale":c.locale,style:x(H.value)},[c.$slots.diy?_(c.$slots,"diy",{key:0,vuecal:v(Y),view:v(p),availableViews:v(g).availableViews}):(i(),m(N,{key:1},[oe(xe,null,re({_:2},[c.$slots.header?{name:"header",fn:z(b=>[_(c.$slots,"header",R(F(b)))]),key:"0"}:void 0,!c.$slots.header&&c.$slots["previous-button"]?{name:"previous-button",fn:z(b=>[_(c.$slots,"previous-button",R(F(b)))]),key:"1"}:void 0,!c.$slots.header&&c.$slots["next-button"]?{name:"next-button",fn:z(b=>[_(c.$slots,"next-button",R(F(b)))]),key:"2"}:void 0,!c.$slots.header&&c.$slots["today-button"]?{name:"today-button",fn:z(b=>[_(c.$slots,"today-button",R(F(b)))]),key:"3"}:void 0,!c.$slots.header&&c.$slots.title?{name:"title",fn:z(b=>[_(c.$slots,"title",R(F(b)))]),key:"4"}:void 0,!c.$slots.header&&c.$slots["schedule-heading"]?{name:"schedule-heading",fn:z(b=>[_(c.$slots,"schedule-heading",R(F(b)))]),key:"5"}:void 0]),1024),j("div",Yt,[oe(fe,{name:`vuecal-slide-fade--${v(p).transitionDirection}`},{default:z(()=>[(i(),m("div",{class:J(["vuecal__scrollable",l.value]),key:v(p).id+v(p).start.getTime()},[$.value?(i(),se(ut,{key:0},re({_:2},[c.$slots["time-cell"]?{name:"time-cell",fn:z(b=>[_(c.$slots,"time-cell",R(F(b)))]),key:"0"}:void 0]),1024)):P("",!0),v(g).weekNumbers&&v(p).isMonth?(i(),m("div",Pt,[(i(!0),m(N,null,G(B.value,b=>(i(),m("div",zt,[_(c.$slots,"week-number",{},()=>[j("small",null,I(b),1)])]))),256))])):P("",!0),j("div",Ct,[oe(rt,null,re({_:2},[c.$slots["weekday-heading"]?{name:"weekday-heading",fn:z(b=>[_(c.$slots,"weekday-heading",R(F(b)))]),key:"0"}:void 0,c.$slots["schedule-heading"]?{name:"schedule-heading",fn:z(b=>[_(c.$slots,"schedule-heading",R(F(b)))]),key:"1"}:void 0]),1024),oe(Et,null,re({_:2},[c.$slots.cell?{name:"cell",fn:z(b=>[_(c.$slots,"cell",R(F(b)))]),key:"0"}:void 0,!c.$slots.cell&&c.$slots["cell-date"]?{name:"cell-date",fn:z(b=>[_(c.$slots,"cell-date",R(F(b)))]),key:"1"}:void 0,!c.$slots.cell&&c.$slots["cell-content"]?{name:"cell-content",fn:z(b=>[_(c.$slots,"cell-content",R(F(b)))]),key:"2"}:void 0,!c.$slots.cell&&c.$slots["cell-events"]?{name:"cell-events",fn:z(b=>[_(c.$slots,"cell-events",R(F(b)))]),key:"3"}:void 0,!c.$slots.cell&&c.$slots.event?{name:"event",fn:z(b=>[_(c.$slots,"event",R(F(b)))]),key:"4"}:void 0,!c.$slots.cell&&c.$slots["event-count"]?{name:"event-count",fn:z(b=>[_(c.$slots,"event-count",R(F(b)))]),key:"5"}:void 0]),1024)])],2))]),_:3},8,["name"])])],64))],14,Mt))}};export{Bt as _};
